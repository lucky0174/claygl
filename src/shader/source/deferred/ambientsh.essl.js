define(function () {
return "@export qtek.deferred.ambient_sh_light\n\nuniform sampler2D gBufferTexture1;\nuniform sampler2D gBufferTexture3;\n\nuniform vec3 lightColor;\nuniform vec3 lightCoefficients[9];\n\nvarying vec2 v_Texcoord;\n\nvec3 calcAmbientSHLight(vec3 N) {\n    // FIXME Index expression must be constant\n    return lightCoefficients[0]\n        + lightCoefficients[1] * N.x\n        + lightCoefficients[2] * N.y\n        + lightCoefficients[3] * N.z\n        + lightCoefficients[4] * N.x * N.z\n        + lightCoefficients[5] * N.z * N.y\n        + lightCoefficients[6] * N.y * N.x\n        + lightCoefficients[7] * (3.0 * N.z * N.z - 1.0)\n        + lightCoefficients[8] * (N.x * N.x - N.y * N.y);\n}\n\nvoid main()\n{\n    vec4 texel1 = texture2D(gBufferTexture1, v_Texcoord);\n    // Is empty\n    if (dot(texel1.rgb, vec3(1.0)) == 0.0) {\n        discard;\n    }\n    vec3 N = texel1.rgb * 2.0 - 1.0;\n    vec3 albedo = texture2D(gBufferTexture3, v_Texcoord).rgb;\n    gl_FragColor.rgb = lightColor * albedo * calcAmbientSHLight(N);\n    gl_FragColor.a = 1.0;\n}\n@end";
});